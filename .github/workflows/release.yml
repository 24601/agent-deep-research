name: Release

on:
  push:
    tags:
      - 'v*'

permissions:
  contents: write

jobs:
  release:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v6

      - name: Set up Python
        uses: actions/setup-python@v6
        with:
          python-version: '3.12'

      - name: Install uv
        uses: astral-sh/setup-uv@v6

      - name: Validate SKILL.md
        run: |
          test -f SKILL.md || { echo "SKILL.md not found"; exit 1; }
          head -10 SKILL.md | grep -q '^name:' || { echo "Missing 'name' in SKILL.md frontmatter"; exit 1; }
          head -10 SKILL.md | grep -q '^description:' || { echo "Missing 'description' in SKILL.md frontmatter"; exit 1; }
          echo "SKILL.md frontmatter is valid"

      - name: Check Python script syntax
        run: python3 -m py_compile scripts/research.py scripts/store.py scripts/upload.py scripts/state.py

      - name: Smoke test
        run: uv run scripts/state.py --help

      - name: Create GitHub Release
        uses: softprops/action-gh-release@v2
        with:
          generate_release_notes: true
